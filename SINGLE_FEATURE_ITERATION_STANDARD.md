# RAG Pro Max 单功能迭代开发规范 V2.0 (升级版)

## 🎯 核心原则

**严格单功能迭代**：一次只实现一个功能，绝不同时开发多个功能

**零污染原则**：新功能开发必须在独立分支进行，验证通过前严禁污染主分支（Main/Master）

## 🔄 标准工作流程 (优化版)

### 1️⃣ 分析与快照 (Analyze & Snapshot)
- 分析当前状态，识别改进点
- **Git检查**：确保主分支干净 (`git status clean`)
- **依赖锁定**：确认当前requirements.txt或环境状态可运行
- **优先级排序**：High Impact + Small Effort 优先

### 2️⃣ 选择与建枝 (Select & Branch) 
- 选择单个功能（Ticket/Issue）
- **创建分支**：`git checkout -b feature/功能名_日期`
- **理由**：如果不建分支，一旦开发失败，回退代码极其痛苦
- **明确完成标准** (Definition of Done)

### 3️⃣ 实现 (Implement)
- 只编写实现该功能所需的最小代码
- **原子提交**：功能复杂时分多次Commit，不要最后一次性提交
- **代码风格**：符合PEP8 (Python) 规范
- **现有功能保护**：严禁修改或删减现有功能，除非获得用户明确同意

### 4️⃣ 双重测试 (Dual Testing) - RAG专项优化
**技术测试 (Tech Test)**：
- 无报错，无Crash，语法正确

**效果测试 (Quality Test) - RAG特有**：
- 该改动是否导致回答速度变慢？
- 该改动是否导致准确率下降？（进行简单的Regression Check）

### 5️⃣ 文档与记录 (Document)
- 更新README.md (如果是新功能)
- 更新CHANGELOG.md (记录版本号和变更点)
- **自动记录**：更新iteration_log.json，标记状态为Pending Review

### 6️⃣ 验证与合并 (Verify & Merge) - 关键优化
- 提交演示/截图给用户

**分支情况处理**：
- ✅ **用户满意**：
  - `git checkout main`
  - `git merge feature/xxx`
  - 打Tag (可选)
  - 删除特性分支
- ❌ **用户不满意/有Bug**：
  - 直接在特性分支修改，重复步骤3-4
  - 或者：方案完全错误，直接废弃分支 (`git branch -D feature/xxx`)
  - **主分支毫发无损**（这是单功能迭代的最大优势）

### 7️⃣ 确认与清理 (Confirm & Clean)
- 记录功能到历史库
- **清理环境**：删除临时文件、临时数据库记录

## ⚠️ 严格禁止

| 禁止项 | 潜在后果 |
|--------|----------|
| ❌ 同时实现多个功能 | 代码耦合，Debug困难 |
| ❌ 跳过测试阶段 | 上线即崩，信任度归零 |
| ❌ 不更新文档 | 下次迭代看不懂这次改了什么 |
| ❌ 直接在Main分支开发 | 一旦改错，回退困难，污染稳定版 |
| ❌ 忽视AI性能指标 | 功能实现了，但响应时间变成30秒，这也是失败 |
| ❌ 不明确失败路径 | 测试不通过时没有明确的"回滚"或"放弃"标准 |
| ❌ 未经同意修改现有功能 | 破坏用户习惯，影响系统稳定性 |
| ❌ 随意删减现有功能 | 导致功能缺失，用户体验下降 |

## ✅ 必须遵守

- ✅ 一次只做一个功能
- ✅ 必须使用分支开发
- ✅ 每个功能都要测试（技术+效果双重测试）
- ✅ 及时更新文档
- ✅ 用户确认才合并到主分支
- ✅ 保持代码简洁和性能稳定
- ✅ **现有功能保护原则**：修改或删减现有功能必须先获得用户明确同意

## 📋 功能选择标准

### 优先级排序
1. **High + Small** - 立即实现
2. **High + Medium** - 本周实现  
3. **Medium + Small** - 有时间实现
4. **Large** - 强制拆分任务

### 工作量定义
- **Small**: 30分钟 - 1小时
- **Medium**: 1-3小时
- **Large**: 3小时以上（必须拆分）

## 🔧 实施工具

- **规划工具**: `detailed_action_planner.py`
- **迭代记录**: `iteration_log.json`
- **版本控制**: Git（必须）
- **自动化工具**: `start_task.py`（自动创建分支和记录）

## 📊 RAG专项成功指标

### 技术指标
- 系统无报错、无崩溃
- 代码符合PEP8规范
- 单元测试通过

### RAG效果指标
- 响应时间 < 3秒
- 检索准确率 > 85%
- 回答质量不下降
- 用户满意度 > 4.0/5

## 🚨 失败处理标准

### 明确的回滚/放弃标准
- **技术失败**：语法错误、系统崩溃 → 立即回滚
- **性能失败**：响应时间 > 10秒 → 优化或放弃
- **效果失败**：准确率下降 > 10% → 重新设计或放弃
- **用户拒绝**：用户明确不满意 → 修改或放弃分支

---

**记住：质量比速度更重要，稳步前进比快速出错更有价值！零污染原则确保主分支始终稳定可用！**
