# RAG Pro Max v2.0.1 - CPU保护增强版

## 🛡️ 重大安全更新

这是一个重要的稳定性更新，专门解决CPU过载和系统死机问题。

### 🚨 紧急CPU保护机制

- **智能停止**: 连续3次检测到CPU > 98%时自动停止OCR处理
- **安全阈值**: CPU保护阈值从95%降至85%，更加安全
- **进程限制**: 最大进程数限制为4个，保留10-12核给系统
- **超时保护**: OCR处理超时时间缩短至10分钟
- **实时监控**: 监控间隔优化为0.5秒，快速响应

### 🔧 技术修复

- ✅ 修复 `batch_ocr_processor.py` 语法错误
- ✅ 修复 `temp_file` 未初始化问题  
- ✅ 完善异常处理和资源清理机制
- ✅ 新增 `emergency_cpu_stop.py` 紧急停止脚本

### 📊 性能改进

| 指标 | v2.0.0 | v2.0.1 | 改进 |
|------|--------|--------|------|
| CPU峰值 | 100% | 85% | ↓15% |
| 系统稳定性 | 易死机 | 稳定 | ✅ |
| 最大进程数 | 8个 | 4个 | 更安全 |
| 监控频率 | 1秒 | 0.5秒 | 更及时 |

### 📚 文档完善

- 📖 **CPU_PROTECTION_V2.md** - 完整的CPU保护机制文档
- 🔧 **TROUBLESHOOTING.md** - 详细的故障排除指南
- 📈 **PERFORMANCE_GUIDE.md** - 性能优化最佳实践
- 📋 **CHANGELOG.md** - 完整的版本更新记录

## 🚀 升级指南

### 自动升级
```bash
git pull origin main
./start.sh
```

### 手动升级
1. 备份当前配置
2. 下载最新版本
3. 运行 `python emergency_cpu_stop.py` 清理旧进程
4. 重新启动应用

## 🆘 紧急使用

如果遇到CPU过载问题：
```bash
# 立即停止所有OCR进程
python emergency_cpu_stop.py

# 检查系统状态
python -c "import psutil; print(f'CPU: {psutil.cpu_percent()}%')"

# 重启应用
./start.sh
```

## 🎯 兼容性

- ✅ **向后兼容**: 完全兼容v2.0.0
- ✅ **配置兼容**: 无需修改现有配置
- ✅ **数据兼容**: 知识库和历史记录完全保留

## 🔍 测试验证

- ✅ CPU保护机制测试通过
- ✅ 紧急停止功能验证正常
- ✅ 语法错误修复确认
- ✅ 系统稳定性大幅提升
- ✅ 所有核心功能正常工作

## 📞 技术支持

### 常见问题
- **Q**: 升级后OCR速度变慢了？
- **A**: 这是正常的，v2.0.1优先保证系统稳定性

- **Q**: 如何调整CPU保护参数？
- **A**: 修改 `src/utils/ocr_optimizer.py` 中的配置

### 获取帮助
- 📖 查看文档: `docs/` 目录
- 🔧 故障排除: `docs/TROUBLESHOOTING.md`
- 🚨 紧急情况: `python emergency_cpu_stop.py`

## 🙏 致谢

感谢所有用户的反馈，特别是关于CPU过载问题的报告，这促使我们开发了这个重要的安全更新。

---

**重要提醒**: 如果你的系统经常出现CPU过载或死机问题，强烈建议升级到v2.0.1。
