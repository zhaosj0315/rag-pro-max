# 更新日志

## v1.8.0 (2025-12-10) - 生产就绪版本 🚀

### 🎉 重大更新
- **RESTful API接口** - 完整的API服务，支持文档上传和智能问答
- **性能监控增强** - 实时性能仪表板，GPU/CPU/内存监控
- **紧凑UI布局** - CSS优化，减少侧边栏滚动需求
- **稳定性优化** - 全局错误处理，智能内存管理

### 📡 API功能
- **文档上传API** - `/api/upload` 支持批量文档上传
- **智能问答API** - `/api/query` 提供问答查询接口
- **知识库管理API** - `/api/kb` 完整的CRUD操作
- **自动文档** - Swagger UI 和 ReDoc 交互式文档

### ⚡ 性能优化
- **GPU加速** - M4 Max GPU完全优化，batch_size=2048
- **内存管理** - 智能内存清理，防止内存泄漏
- **并行处理** - 多进程文档处理，充分利用多核CPU
- **缓存机制** - 查询缓存，重复查询速度提升80%

### 🎨 用户体验
- **紧凑布局** - CSS优化，侧边栏元素更紧凑
- **错误处理** - 友好的错误提示和解决建议
- **进度显示** - 详细的处理进度和ETA估算
- **状态监控** - 实时系统资源监控

### 🔧 技术改进
- **模块化架构** - 103个Python模块，24,515行代码
- **代码质量** - 企业级代码标准，完整测试覆盖
- **文档完善** - 72个文档文件，使用指南完整
- **部署优化** - Docker支持，一键部署脚本

---

## v1.7.3 (2025-12-10) - 模块导入修复 🔧

### 🐛 关键修复
- **ModuleNotFoundError 修复** - 解决 `src.core.environment` 导入错误
- **Python包结构完善** - 添加缺失的 `__init__.py` 文件
- **路径解析优化** - 自动添加项目根目录到 `sys.path`

### ✅ 稳定性提升
- **出厂测试通过** - 56/61 测试通过，5个跳过（离线模式）
- **启动流程优化** - 确保所有模块正确加载
- **向后兼容** - 保持所有现有功能完整

### 📦 技术细节
- 创建 `/src/__init__.py` 使 src 成为正确的 Python 包
- 在 `apppro.py` 中添加动态路径解析
- 确保从项目根目录运行时模块导入正常

---

## v1.7.2 (2025-12-10) - Stage 14-17 极致重构完成 🚀

### 🎉 重大更新
- **Stage 14-17 完整重构** - 47模块架构，主文件精简至40行
- **极致模块化** - 98.6%代码重构，单一职责原则
- **企业级架构** - 9大功能域，完整测试体系

### ⚡ 架构优化
- **主文件精简** - 从2805行→40行 (98.6%减少)
- **47模块架构** - 完全模块化设计
- **4层应用入口** - apppro_final.py → apppro_ultra.py → apppro_minimal.py → apppro.py
- **9大功能域** - core, ui, processors, logging, config, chat, kb, query, utils

### 🔧 新增功能
- **完整侧边栏** - 统一配置界面
- **消息渲染器** - 独立消息显示系统
- **自动摘要** - 知识库摘要生成
- **队列管理** - 问题队列处理
- **查询重写** - 智能查询优化

### 📦 新增模块
- `src/core/main_controller.py` - 主控制器
- `src/core/environment.py` - 环境配置
- `src/ui/complete_sidebar.py` - 完整侧边栏
- `src/ui/page_style.py` - 页面样式
- `src/ui/message_renderer.py` - 消息渲染器
- `src/kb/kb_loader.py` - 知识库加载器
- `src/query/query_processor.py` - 查询处理器
- `src/query/query_rewriter.py` - 查询重写器
- `src/queue/queue_manager.py` - 队列管理器
- `src/documents/document_manager.py` - 文档管理器
- `src/summary/auto_summary.py` - 自动摘要
- `src/utils/app_utils.py` - 应用工具

### ✅ 测试
- 34个测试文件，覆盖所有核心模块
- Stage 14-17模块测试 100%通过
- 文档可行性测试 7/8通过
- 代码质量评分 100/100

### 📚 文档
- 47个文档文件
- Stage 14-17重构总结
- 主文件简化文档
- 队列阻塞修复文档
- V1.7功能文档和迁移指南

---

## v1.7.0 (2025-12-09) - 并发优化（最终版）
- ⚡ **异步向量化管道** - CPU和GPU流水线并行，加速比1.7x
- 📊 **动态批量优化** - 自动调整batch size，内存占用减少33%
- 🎯 **智能任务调度** - 根据任务类型分配资源，利用率提升20-30%
- 🚀 **性能提升** - 处理速度提升40%，GPU利用率提升15%
- 🔧 **错误处理增强** - 完整的异常处理和资源清理机制
- 💾 **GPU显存优化** - 智能检测GPU显存，避免OOM
- 📦 新增 4 个模块（async_pipeline, dynamic_batch, smart_scheduler, concurrency_manager）
- 🧪 测试：5/5 可行性测试通过
- 📚 完整文档（功能文档、可行性报告、迁移指南）
- ✅ 专家审查：10位专家审查，6个高优先级问题已修复

### 📚 文档
- [优化总结](docs/OPTIMIZATION_SUMMARY.md)
- [方案2报告](docs/PLAN2_COMPLETED.md)
- [方案B报告](docs/PLANB_COMPLETED.md)

---

## v1.5.1 (2025-12-09)

### 📺 演示视频
- **添加演示视频**: 压缩版 16MB，高清版 146MB
  - README 顶部添加视频链接
  - 使用 Git LFS 管理大文件
  - 支持快速预览和高清下载

### ✨ 新增功能
- **性能监控面板**: 实时查看查询性能和统计信息
  - 查询性能统计（平均/最快/最慢）
  - 查询统计（总数/总耗时）
  - 最近查询详情
  - LogManager 单例模式，全局共享性能数据
  
- **推荐问题优化**: 结合知识库内容，智能生成推荐问题
  - 关键词提取（jieba 分词）
  - 知识库查询（获取相关主题）
  - 自定义推荐问题管理
  - 推荐问题历史记录
  - 历史持久化存储
  - 统计信息展示
  
- **错误恢复机制**: 自动重试和友好提示
  - 自动重试功能（可配置）
  - 9种常见错误的友好提示
  - 针对性恢复建议
  - 装饰器支持

### 🐛 修复问题
- **性能监控无数据** - end_timer 未记录性能指标
- **LogManager 多实例** - 改为单例模式，数据全局共享
- **推荐问题不变化** - 结合知识库内容，智能生成
- **推荐问题不显示** - 移除有问题的验证逻辑
- **知识库查询失败** - 兼容 ContextChatEngine 的 chat() 方法

### 📦 新增文件
- `src/ui/performance_monitor.py` (100行)
- `src/ui/suggestion_panel.py` (130行)
- `suggestion_history/` (历史存储目录)

### 🔧 功能改进
- 扩展 SuggestionEngine（+80行）
- 扩展 ErrorHandler（+70行）
- LogManager 单例模式（+20行）
- 推荐问题生成改进（+50行）
- 新增 `@retry_on_error` 装饰器
- 新增 `@handle_errors` 装饰器
- 新增 `_extract_keywords()` 函数

### 🧪 测试
- 可行性测试：7/7 通过
- 出厂测试：58/63 通过
- 新增 LogManager 单例测试
- 新增推荐问题生成测试

### 📝 代码质量
- 新增代码：+600 行
- 模块化设计
- 完整测试覆盖
- 单例模式优化

---

## v1.5.0 (2025-12-09)

### 🚀 性能优化
- **查询缓存系统**: LRU 缓存机制，提升重复查询速度 80%+
- **内存优化**: 优化模型加载和内存管理

### 📦 新增模块
- `src/utils/query_cache.py` - 查询缓存管理器 (71行)
- `src/chat/suggestion_engine.py` - 推荐问题生成引擎 (67行)
- `src/utils/error_handler.py` - 统一错误处理模块 (82行)

### ✨ 功能改进
- **扩展 LogManager**: 新增 10+ 个日志方法
  - `start_operation()` / `complete_operation()`
  - `processing()` / `data_summary()`
  - `separator()` / `progress_bar()`
  - `cpu_multicore_*()` 系列方法
- **推荐引擎**: 独立的推荐问题管理
- **错误处理**: 友好的错误提示和恢复建议

### 🐛 修复问题
- **terminal_logger 引用**: 全面替换为 LogManager
- **logger 导入冲突**: 修复 model_manager.py 和 chat_engine.py
- **不存在的方法**: 替换 log_model_loading 为标准方法
- **重复参数**: 修复 rag_engine.py 和 index_builder.py
- **语法错误**: 修复 model_manager.py 的括号问题

### 🧪 测试
- 新增 v1.5.0 可行性测试（6/6 通过）
- 出厂测试：58/63 通过
- 所有新模块 100% 测试覆盖

### 📝 代码质量
- 新增 3 个独立模块（+220 行）
- 代码更模块化、可维护
- 统一错误处理机制
- 统一日志接口

---

## v1.4.4 (2025-12-09)

### 🐛 Bug 修复
- **修复追问推荐按钮导致回答消失的 bug**
- **修复队列处理导致回答无法显示的问题**

### ✨ 功能改进
- 推荐问题在回答后立即显示（chat_message 块外）
- 队列处理改为手动触发模式，避免内容丢失
- 推荐问题基于上下文生成，支持知识库验证
- 用户体验优化：可控制处理节奏，查看每个回答

### 🧪 测试
- 可行性测试：7/7 通过
- 出厂测试：58/63 通过 (92.1%)
- 语法检查：通过

### 📝 文档
- 创建 RELEASE_v1.4.4.md
- 创建 VERSION_v1.4.4_SUMMARY.md
- 创建 RELEASE_CHECKLIST_v1.4.4.md
- 更新 README.md

### 🗑️ 清理
- 删除 .DS_Store 文件
- 清理 Python 缓存
- 归档旧的阶段总结文档
- 清理测试数据

---

## v1.4.2 (2025-12-09)

### 🎉 重大更新
- **Stage 10-12 重构完成** - 全部 12 个阶段完成
- **代码迁移完成** - apppro.py 迁移到新模块接口
- **接口统一** - 所有模块使用标准接口

### 📦 新增模块
- `src/logging/` - 统一日志管理系统
- `src/config/` - 配置管理系统
- `src/chat/` - 聊天管理系统

### 🔧 代码改进
- 提取 16 个独立模块，共 2572 行代码
- 替换 9 个自定义日志方法为标准接口
- 统一配置/聊天/知识库管理接口
- 采用兼容层模式，保持向后兼容

### ✅ 测试
- 新增 20 个单元测试（100% 通过）
- 出厂测试：61/66 通过 (92.4%)
- 应用启动测试：通过

### 🧹 清理
- 删除备份文件和临时测试
- 归档 20 个临时文档
- 清理 Python 缓存

### 📚 文档
- 更新 README.md
- 新增 RELEASE_v1.4.2.md
- 新增 MIGRATION_COMPLETE.md
- 更新项目结构图

### 🎯 代码质量
- ⭐⭐⭐⭐⭐ 生产就绪
- 模块化程度：优秀
- 测试覆盖率：高
- 向后兼容：100%

---

## v1.4.0 (2025-12-09)

### 🔧 Stage 6 并行执行重构
- 提取并行执行模块（ParallelExecutor）
- 统一并行接口，智能判断串行/并行
- 阈值优化：元数据 100→50，节点 20→10
- 新增 CPU 负载感知
- 中型知识库性能提升 30-40%

### 📝 问题队列机制
- 支持多问题排队处理
- 避免并发冲突

### 🧪 测试
- 新增 5 个单元测试
- 完整文档和对比分析

---

## v1.3.1 (2025-12-09)

### ⚡ Stage 5.3 用户体验优化
- 元数据提取默认关闭（默认快 30%）
- 问答流程流畅度优化（延迟降低 40-50%）
- 流式输出更流畅
- 缓存维度检测
- 累计性能提升 40-50%

---

## v1.3.0 (2025-12-09)

### ⚡ Stage 5 性能优化
- 元数据提取可选化（可加速 30%）
- 摘要队列异步化（加速 7.5%）
- 累计性能提升 35%
- 新增性能配置选项

---

## v1.2.1 (2025-12-09)

### 🔧 完整重构 (Stage 1-4)
- 提取 13 个模块，共 2289 行代码
- 主文件减少 709 行 (-22.1%)
- 删除重复代码 118 行
- 出厂测试 61/67 通过

---

## v1.2.0 (2025-12-08)

### 🔧 Stage 3 UI组件重构
- 提取 6 个 UI 模块
- 新增状态管理系统
- 修复 OCR 多进程调度问题
- 移除 OCR 页数限制

---

## v1.1.5 (2025-12-08)

### 🔧 Stage 2 重构
- 提取 RAG 核心引擎
- 提取资源监控模块
- 提取模型工具模块
- 新增 11 个单元测试

---

## v1.1.4 (2025-12-08)

### 🔧 模型管理重构
- 提取到 utils/model_manager.py
- 修复嵌入模型维度不匹配问题
- 新增模型加载日志

---

## v1.1.3 (2025-12-08)

### ✨ GPU利用率优化
- GPU 利用率：29.6% → 80-99%
- 统一内存管理
- 显存自动清理
- torch.compile 编译加速

---

## v1.1.2 (2025-12-08)

### ✨ 功能增强
- 效果对比模式
- 使用统计可视化
- 视觉反馈优化

---

## v1.1.1 (2025-12-07)

### ⚡ 易用性改进
- 一键配置（新手模式）
- 专业术语通俗化
- 侧边栏分组优化

---

## v1.0.0 (2024-11-30)

### ✨ 初始版本
- 多种文档格式支持
- 向量检索功能
- 多轮对话支持
- macOS 打包支持
- 系统监控面板
- 多核优化（80 线程）
