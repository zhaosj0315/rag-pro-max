# 局部刷新监控功能使用说明

## 🎯 功能概述

局部刷新监控功能实现了**只刷新监控区域而不影响对话功能**的智能监控系统。

## ✨ 核心特性

### 🔄 局部刷新机制
- **非侵入式设计**: 监控数据更新不会触发整个页面重新加载
- **Session State缓存**: 使用Streamlit的session state机制避免重复计算
- **智能更新策略**: 每10秒自动更新一次，也支持手动刷新

### 📊 实时监控指标
- **响应时间**: 显示当前响应时间和变化趋势
- **查询次数**: 统计查询总数和增量变化
- **成功率**: 显示系统成功率和波动情况
- **系统状态**: 实时健康状态指示器

### 📈 可视化展示
- **指标卡片**: 清晰的数值展示和变化趋势
- **状态指示器**: 绿色/黄色/红色状态灯
- **趋势图表**: 可选的24小时趋势图表
- **时间戳**: 显示最后更新时间

## 🚀 使用方法

### 1. 访问监控功能
1. 打开RAG Pro Max应用
2. 在左侧边栏选择 **"📊 监控"** 标签
3. 在监控类型下拉框中选择 **"局部刷新监控"**

### 2. 监控操作
- **自动更新**: 系统每10秒自动刷新监控数据
- **手动刷新**: 点击 **"🔄 刷新"** 按钮立即更新
- **趋势图**: 勾选 **"显示趋势图"** 查看历史趋势

### 3. 状态解读
- 🟢 **系统正常**: 响应时间 < 2秒
- 🟡 **需要注意**: 响应时间 2-5秒
- 🔴 **异常状态**: 响应时间 > 5秒

## 🔧 技术实现

### 核心组件
```python
# 主要类
LocalRefreshMonitor: 局部刷新监控器
- render_non_intrusive_monitor(): 非侵入式监控渲染
- _get_current_metrics(): 获取实时指标
- _render_simple_trend_chart(): 渲染趋势图

# 集成函数
show_local_monitor(): 显示局部监控
```

### 关键技术
- **Session State**: 避免重复计算和全页面刷新
- **Container固定**: 使用固定容器只更新内容
- **时间戳控制**: 智能判断是否需要更新数据
- **Plotly图表**: 轻量级趋势图表展示

## 🎯 使用场景

### 适用情况
- ✅ 需要实时监控系统状态
- ✅ 不希望监控影响对话体验
- ✅ 需要查看性能趋势
- ✅ 系统调试和优化

### 优势对比
| 特性 | 传统监控 | 局部刷新监控 |
|------|----------|-------------|
| 页面刷新 | 全页面 | 仅监控区域 |
| 对话影响 | 会中断 | 不影响 |
| 更新频率 | 较低 | 可调节 |
| 资源消耗 | 较高 | 较低 |

## 🔍 故障排除

### 常见问题
1. **监控数据不更新**
   - 检查网络连接
   - 手动点击刷新按钮
   - 重新选择监控类型

2. **趋势图不显示**
   - 确保已勾选"显示趋势图"
   - 检查plotly依赖是否安装

3. **状态显示异常**
   - 检查系统资源使用情况
   - 查看应用日志

## 📝 更新日志

### v1.0.0 (2026-01-01)
- ✅ 实现局部刷新监控核心功能
- ✅ 集成到侧边栏监控标签
- ✅ 支持实时指标和趋势图
- ✅ 完成测试验证

## 🤝 反馈建议

如果您在使用过程中遇到问题或有改进建议，请：
1. 查看应用日志获取详细信息
2. 尝试重新启动监控功能
3. 联系技术支持团队

---

**注意**: 此功能专为提升用户体验而设计，确保监控不会干扰正常的对话和查询操作。
