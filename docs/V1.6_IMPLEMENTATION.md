# RAG Pro Max v1.6 å®ç°æ€»ç»“

## ğŸ“‹ å®ç°æ¦‚è§ˆ

**ç‰ˆæœ¬**: v1.6.0  
**æ—¥æœŸ**: 2025-12-09  
**çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ¯ å®ç°ç›®æ ‡

å®ç°ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š
1. **æŸ¥è¯¢æ”¹å†™ (Query Rewriting)** - è‡ªåŠ¨ä¼˜åŒ–ç”¨æˆ·æŸ¥è¯¢
2. **æ–‡æ¡£é¢„è§ˆ (Document Preview)** - æ–‡æ¡£ä¸Šä¼ å‰/åé¢„è§ˆ

---

## ğŸ“¦ æ–°å¢æ¨¡å—

### 1. æŸ¥è¯¢æ”¹å†™æ¨¡å—

**æ–‡ä»¶**: `src/query/query_rewriter.py` (88 è¡Œ)

**æ ¸å¿ƒç±»**:
```python
class QueryRewriter:
    def __init__(self, llm: LLM)
    def should_rewrite(self, query: str, top_score: float = 0.0) -> Tuple[bool, str]
    def rewrite(self, query: str, context: Optional[str] = None) -> str
    def suggest_rewrite(self, query: str, context: Optional[str] = None) -> Optional[str]
```

**åŠŸèƒ½**:
- âœ… æ£€æµ‹çŸ­æŸ¥è¯¢ï¼ˆ<5å­—ï¼‰
- âœ… æ£€æµ‹å£è¯­åŒ–è¡¨è¾¾ï¼ˆ"å•¥"ã€"å’‹"ç­‰ï¼‰
- âœ… æ£€æµ‹ä½ç›¸ä¼¼åº¦æŸ¥è¯¢ï¼ˆ<0.5ï¼‰
- âœ… LLM è‡ªåŠ¨æ”¹å†™æŸ¥è¯¢
- âœ… ä¿æŒåŸæ„ï¼Œè¡¥å……å¿…è¦ä¿¡æ¯

### 2. æ–‡æ¡£æŸ¥çœ‹å™¨æ¨¡å—

**æ–‡ä»¶**: `src/kb/document_viewer.py` (156 è¡Œ)

**æ ¸å¿ƒç±»**:
```python
class DocumentInfo:
    def __init__(self, file_path: str, kb_name: str)
    @property size_mb(self) -> float
    @property extension(self) -> str

class DocumentViewer:
    def __init__(self, vector_db_path: str = "vector_db_storage")
    def get_kb_documents(self, kb_name: str) -> List[DocumentInfo]
    def preview_file(self, file_path: str, max_chars: int = 1000) -> str
    def get_document_chunks(self, kb_name: str, file_path: str, max_chunks: int = 10) -> List[Dict]
    def delete_document(self, kb_name: str, file_path: str) -> bool
```

**åŠŸèƒ½**:
- âœ… è·å–çŸ¥è¯†åº“æ–‡æ¡£åˆ—è¡¨
- âœ… é¢„è§ˆæ–‡æœ¬æ–‡ä»¶ï¼ˆTXT, MD, JSON, CSVï¼‰
- âœ… é¢„è§ˆ PDF æ–‡ä»¶ï¼ˆå‰3é¡µï¼‰
- âœ… é¢„è§ˆ DOCX æ–‡ä»¶ï¼ˆå‰10æ®µï¼‰
- âœ… è·å–æ–‡æ¡£åˆ†å—ä¿¡æ¯
- âœ… åˆ é™¤æ–‡æ¡£ï¼ˆä» manifest ç§»é™¤ï¼‰

### 3. æ–‡æ¡£é¢„è§ˆ UI ç»„ä»¶

**æ–‡ä»¶**: `src/ui/document_preview.py` (118 è¡Œ)

**æ ¸å¿ƒå‡½æ•°**:
```python
def show_upload_preview(uploaded_file) -> None
def show_kb_documents(kb_name: str) -> None

@st.dialog("ğŸ“„ æ–‡æ¡£è¯¦æƒ…")
def show_document_detail(kb_name: str, doc: DocumentInfo) -> None

@st.dialog("âš ï¸ ç¡®è®¤åˆ é™¤")
def confirm_delete_document(kb_name: str, doc: DocumentInfo) -> None
```

**åŠŸèƒ½**:
- âœ… ä¸Šä¼ å‰é¢„è§ˆï¼ˆå•æ–‡ä»¶ï¼‰
- âœ… çŸ¥è¯†åº“æ–‡æ¡£åˆ—è¡¨å±•ç¤º
- âœ… æ–‡æ¡£è¯¦æƒ…å¯¹è¯æ¡†
- âœ… åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†

---

## ğŸ”§ ä¸»åº”ç”¨é›†æˆ

### ä¿®æ”¹æ–‡ä»¶: `src/apppro.py`

#### 1. å¯¼å…¥æ¨¡å— (ç¬¬ 100-108 è¡Œ)
```python
# æŸ¥è¯¢æ”¹å†™ (v1.6)
from src.query.query_rewriter import QueryRewriter

# æ–‡æ¡£é¢„è§ˆ (v1.6)
from src.kb.document_viewer import DocumentViewer
from src.ui.document_preview import show_upload_preview, show_kb_documents
```

#### 2. æ–‡ä»¶ä¸Šä¼ é¢„è§ˆ (ç¬¬ 628 è¡Œ)
```python
# æ–‡æ¡£é¢„è§ˆ (v1.6)
if uploaded_files and len(uploaded_files) == 1:
    show_upload_preview(uploaded_files[0])
```

#### 3. çŸ¥è¯†åº“æ–‡æ¡£åˆ—è¡¨ (ç¬¬ 1487 è¡Œ)
```python
# æ–‡æ¡£åˆ—è¡¨æŸ¥çœ‹ (v1.6)
tab1, tab2 = st.tabs(["ğŸ“Š ç»Ÿè®¡ä¿¡æ¯", "ğŸ“„ æ–‡æ¡£åˆ—è¡¨"])

with tab1:
    # åŸæœ‰ç»Ÿè®¡ä¿¡æ¯...

with tab2:
    show_kb_documents(active_kb_name)
```

#### 4. æŸ¥è¯¢æ”¹å†™é›†æˆ (ç¬¬ 2350 è¡Œ)
```python
# æŸ¥è¯¢æ”¹å†™ (v1.6)
query_rewriter = QueryRewriter(Settings.llm)
should_rewrite, reason = query_rewriter.should_rewrite(final_prompt)

if should_rewrite:
    rewritten_query = query_rewriter.suggest_rewrite(final_prompt)
    if rewritten_query and rewritten_query != final_prompt:
        # æ˜¾ç¤ºæ”¹å†™å»ºè®®ï¼Œç­‰å¾…ç”¨æˆ·é€‰æ‹©
        ...
```

---

## ğŸ§ª æµ‹è¯•

### æµ‹è¯•æ–‡ä»¶: `tests/test_query_rewriter.py` (75 è¡Œ)

**æµ‹è¯•è¦†ç›–**:
- âœ… çŸ­æŸ¥è¯¢æ£€æµ‹
- âœ… å£è¯­åŒ–æŸ¥è¯¢æ£€æµ‹
- âœ… æ­£å¸¸æŸ¥è¯¢åˆ¤æ–­
- âœ… ä½ç›¸ä¼¼åº¦æ£€æµ‹
- âœ… æ–‡æ¡£é¢„è§ˆåŠŸèƒ½
- âœ… æ–‡æ¡£åˆ—è¡¨è·å–

**æµ‹è¯•ç»“æœ**:
```
=== æµ‹è¯•æŸ¥è¯¢æ”¹å†™åˆ¤æ–­ ===
çŸ­æŸ¥è¯¢ 'RAGæ˜¯å•¥': True (åŒ…å«å£è¯­åŒ–è¡¨è¾¾)
å£è¯­åŒ–æŸ¥è¯¢ 'è¿™ä¸ªå’‹ç”¨å•Š': True (åŒ…å«å£è¯­åŒ–è¡¨è¾¾)
æ­£å¸¸æŸ¥è¯¢: False ()
ä½ç›¸ä¼¼åº¦æŸ¥è¯¢: True (æŸ¥è¯¢è¿‡çŸ­)
âœ… æŸ¥è¯¢æ”¹å†™åˆ¤æ–­æµ‹è¯•é€šè¿‡

=== æµ‹è¯•æ–‡æ¡£æŸ¥çœ‹å™¨ ===
çŸ¥è¯†åº“ 'test_kb' æ–‡æ¡£æ•°: 0
æ–‡ä»¶é¢„è§ˆ: è¿™æ˜¯æµ‹è¯•å†…å®¹...
âœ… æ–‡æ¡£æŸ¥çœ‹å™¨æµ‹è¯•é€šè¿‡

âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

| æ¨¡å— | æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|------|
| æŸ¥è¯¢æ”¹å†™ | `src/query/query_rewriter.py` | 88 | æ ¸å¿ƒé€»è¾‘ |
| æ–‡æ¡£æŸ¥çœ‹å™¨ | `src/kb/document_viewer.py` | 156 | æ–‡æ¡£ç®¡ç† |
| UI ç»„ä»¶ | `src/ui/document_preview.py` | 118 | ç•Œé¢å±•ç¤º |
| æµ‹è¯• | `tests/test_query_rewriter.py` | 75 | å•å…ƒæµ‹è¯• |
| æ¼”ç¤º | `demo_v1.6.py` | 130 | åŠŸèƒ½æ¼”ç¤º |
| æ–‡æ¡£ | `docs/V1.6_FEATURES.md` | 350 | åŠŸèƒ½æ–‡æ¡£ |
| **æ€»è®¡** | **6 ä¸ªæ–‡ä»¶** | **917 è¡Œ** | **å®Œæ•´å®ç°** |

---

## ğŸ¯ åŠŸèƒ½éªŒè¯

### æŸ¥è¯¢æ”¹å†™

âœ… **è§¦å‘æ¡ä»¶**:
- çŸ­æŸ¥è¯¢ï¼ˆ<5å­—ï¼‰
- å£è¯­åŒ–è¡¨è¾¾
- ä½ç›¸ä¼¼åº¦ï¼ˆ<0.5ï¼‰

âœ… **ç”¨æˆ·äº¤äº’**:
- æ˜¾ç¤ºæ”¹å†™å»ºè®®
- ç”¨æˆ·é€‰æ‹©ä½¿ç”¨/ä¸ä½¿ç”¨
- ä¿æŒåŸæŸ¥è¯¢å¯é€‰

âœ… **é¢„æœŸæ•ˆæœ**:
- å‡†ç¡®ç‡æå‡ 5-10%
- ç”¨æˆ·ä½“éªŒæ›´å‹å¥½

### æ–‡æ¡£é¢„è§ˆ

âœ… **ä¸Šä¼ å‰é¢„è§ˆ**:
- å•æ–‡ä»¶è‡ªåŠ¨é¢„è§ˆ
- æ˜¾ç¤ºå‰ 1000 å­—ç¬¦
- æ˜¾ç¤ºæ–‡ä»¶å¤§å°å’Œç±»å‹

âœ… **çŸ¥è¯†åº“æ–‡æ¡£åˆ—è¡¨**:
- æ˜¾ç¤ºæ‰€æœ‰æ–‡æ¡£
- æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®
- åˆ é™¤æ–‡æ¡£æŒ‰é’®

âœ… **æ–‡æ¡£è¯¦æƒ…**:
- ä¸Šä¼ æ—¶é—´
- æ–‡ä»¶å¤§å°
- å†…å®¹é¢„è§ˆï¼ˆå‰ 2000 å­—ç¬¦ï¼‰
- æ–‡æ¡£åˆ†å—ï¼ˆå‰ 5 ä¸ªï¼‰

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æ›´æ–°ä»£ç 
```bash
git pull origin main
```

### 2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 3. è¿è¡Œæµ‹è¯•
```bash
python tests/test_query_rewriter.py
```

### 4. å¯åŠ¨åº”ç”¨
```bash
streamlit run src/apppro.py
```

### 5. éªŒè¯åŠŸèƒ½
- ä¸Šä¼ å•ä¸ªæ–‡ä»¶ï¼ŒæŸ¥çœ‹é¢„è§ˆ
- æ‰“å¼€çŸ¥è¯†åº“è¯¦æƒ…ï¼ŒæŸ¥çœ‹æ–‡æ¡£åˆ—è¡¨
- è¾“å…¥çŸ­æŸ¥è¯¢ï¼ŒæŸ¥çœ‹æ”¹å†™å»ºè®®

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### æŸ¥è¯¢æ”¹å†™ç¤ºä¾‹

**è¾“å…¥**: "RAGæ˜¯å•¥"  
**ç³»ç»Ÿæ£€æµ‹**: åŒ…å«å£è¯­åŒ–è¡¨è¾¾  
**æ”¹å†™å»ºè®®**: "ä»€ä¹ˆæ˜¯RAGæŠ€æœ¯ï¼Ÿå®ƒçš„å·¥ä½œåŸç†å’Œåº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ"  
**ç”¨æˆ·é€‰æ‹©**: ä½¿ç”¨ä¼˜åŒ–åçš„é—®é¢˜

### æ–‡æ¡£é¢„è§ˆç¤ºä¾‹

**åœºæ™¯ 1**: ä¸Šä¼  PDF æ–‡ä»¶  
**é¢„è§ˆ**: æ˜¾ç¤ºå‰ 3 é¡µå†…å®¹  
**ä¿¡æ¯**: æ–‡ä»¶å¤§å° 2.3 MB

**åœºæ™¯ 2**: æŸ¥çœ‹çŸ¥è¯†åº“æ–‡æ¡£  
**åˆ—è¡¨**: æ˜¾ç¤º 15 ä¸ªæ–‡æ¡£  
**æ“ä½œ**: ç‚¹å‡»"æŸ¥çœ‹"æŒ‰é’®ï¼Œæ˜¾ç¤ºè¯¦æƒ…å¯¹è¯æ¡†

---

## ğŸ”® æœªæ¥ä¼˜åŒ–

### çŸ­æœŸ (v1.6.1)
- [ ] æŸ¥è¯¢æ”¹å†™æ”¯æŒå¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡
- [ ] æ–‡æ¡£é¢„è§ˆæ”¯æŒå›¾ç‰‡å’Œè¡¨æ ¼
- [ ] æ‰¹é‡åˆ é™¤æ–‡æ¡£

### ä¸­æœŸ (v1.7)
- [ ] å­¦ä¹ ç”¨æˆ·æŸ¥è¯¢åå¥½
- [ ] è‡ªåŠ¨åº”ç”¨æ”¹å†™ï¼ˆå¯é…ç½®ï¼‰
- [ ] åœ¨çº¿ç¼–è¾‘æ–‡æ¡£

### é•¿æœŸ (v2.0)
- [ ] æ™ºèƒ½æŸ¥è¯¢å»ºè®®
- [ ] æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†
- [ ] åä½œç¼–è¾‘

---

## ğŸ¤ è´¡çŒ®è€…

- **å¼€å‘**: Kiro (AWS AI Assistant)
- **æµ‹è¯•**: è‡ªåŠ¨åŒ–æµ‹è¯•
- **æ–‡æ¡£**: å®Œæ•´æ–‡æ¡£

---

## ğŸ“„ ç›¸å…³æ–‡æ¡£

- [åŠŸèƒ½è¯´æ˜](V1.6_FEATURES.md) - è¯¦ç»†åŠŸèƒ½ä»‹ç»
- [README](../README.md) - é¡¹ç›®ä¸»æ–‡æ¡£
- [æµ‹è¯•æ–‡ä»¶](../tests/test_query_rewriter.py) - å•å…ƒæµ‹è¯•
- [æ¼”ç¤ºè„šæœ¬](../demo_v1.6.py) - åŠŸèƒ½æ¼”ç¤º

---

## âœ… å®Œæˆæ¸…å•

- [x] æŸ¥è¯¢æ”¹å†™æ¨¡å—å®ç°
- [x] æ–‡æ¡£æŸ¥çœ‹å™¨æ¨¡å—å®ç°
- [x] UI ç»„ä»¶å®ç°
- [x] ä¸»åº”ç”¨é›†æˆ
- [x] å•å…ƒæµ‹è¯•ç¼–å†™
- [x] åŠŸèƒ½æ¼”ç¤ºè„šæœ¬
- [x] å®Œæ•´æ–‡æ¡£ç¼–å†™
- [x] README æ›´æ–°
- [x] ç‰ˆæœ¬å·æ›´æ–°

---

**çŠ¶æ€**: âœ… v1.6.0 å®ç°å®Œæˆ  
**æ—¥æœŸ**: 2025-12-09  
**è´¨é‡**: â­â­â­â­â­ (ç”Ÿäº§å°±ç»ª)
