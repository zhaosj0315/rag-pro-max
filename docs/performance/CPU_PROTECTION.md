# CPU ä¿æŠ¤åŠŸèƒ½è¯´æ˜

## ğŸš¨ é—®é¢˜èƒŒæ™¯

åœ¨å¤„ç†å¤§é‡OCRä»»åŠ¡æ—¶ï¼Œç³»ç»ŸCPUä½¿ç”¨ç‡å¯èƒ½è¾¾åˆ°100%ï¼Œå¯¼è‡´ï¼š
- ç³»ç»Ÿè¿‡çƒ­è‡ªåŠ¨å…³æœº
- åº”ç”¨æ— å“åº”
- å…¶ä»–ç¨‹åºå¡æ­»

## ğŸ›¡ï¸ è§£å†³æ–¹æ¡ˆ

æ–°å¢CPUä½¿ç”¨ç‡ä¿æŠ¤æœºåˆ¶ï¼Œç¡®ä¿CPUä½¿ç”¨ç‡ä¸è¶…è¿‡90%ï¼Œä¿æŠ¤ç³»ç»Ÿç¨³å®šè¿è¡Œã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### 1. å®æ—¶CPUç›‘æ§
- æ¯0.5ç§’æ£€æŸ¥ä¸€æ¬¡CPUä½¿ç”¨ç‡
- è¶…è¿‡90%æ—¶è‡ªåŠ¨å¯åŠ¨é™æµä¿æŠ¤
- æ¢å¤æ­£å¸¸åè‡ªåŠ¨è§£é™¤é™æµ

### 2. æ™ºèƒ½çº¿ç¨‹è°ƒåº¦
- æ ¹æ®CPUä½¿ç”¨ç‡åŠ¨æ€è°ƒæ•´å·¥ä½œçº¿ç¨‹æ•°
- CPU > 85%ï¼šå‡å°‘75%çº¿ç¨‹æ•°
- CPU > 70%ï¼šå‡å°‘50%çº¿ç¨‹æ•°
- CPU < 70%ï¼šæ­£å¸¸çº¿ç¨‹æ•°

### 3. å®‰å…¨å¹¶è¡Œæ‰§è¡Œ
- ä»»åŠ¡æäº¤å‰æ£€æŸ¥CPUä½¿ç”¨ç‡
- è¿‡é«˜æ—¶å»¶è¿Ÿæäº¤æˆ–è½¬ä¸ºä¸²è¡Œæ‰§è¡Œ
- è‡ªåŠ¨è¶…æ—¶ä¿æŠ¤ï¼ˆ30ç§’ï¼‰

### 4. ç´§æ€¥ä¿æŠ¤æœºåˆ¶
- CPU > 95%ï¼šå¼ºåˆ¶ä¼‘çœ 2ç§’
- CPU > 98%ï¼šé™ä½è¿›ç¨‹ä¼˜å…ˆçº§
- è¿ç»­é«˜è´Ÿè½½ï¼šè‡ªåŠ¨æ¸…ç†å†…å­˜

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: å®‰å…¨å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
# ä½¿ç”¨å®‰å…¨å¯åŠ¨è„šæœ¬
./start_safe.sh

# è·³è¿‡æµ‹è¯•ç›´æ¥å¯åŠ¨
./start_safe.sh --skip-test
```

### æ–¹æ³•2: æ‰‹åŠ¨å¯ç”¨

```python
from src.utils.cpu_throttle import start_global_cpu_protection
start_global_cpu_protection()
```

### æ–¹æ³•3: ç´§æ€¥ä¿®å¤

å¦‚æœç³»ç»Ÿå·²ç»åœ¨è¿è¡Œä¸”CPUè¿‡é«˜ï¼š

```bash
# è¿è¡Œç´§æ€¥ä¿®å¤è„šæœ¬
python3 cpu_protection_hotfix.py
```

## âš™ï¸ é…ç½®é€‰é¡¹

ç¼–è¾‘ `config/cpu_protection.json`ï¼š

```json
{
  "cpu_protection": {
    "enabled": true,
    "max_cpu_percent": 90.0,    // æœ€å¤§CPUä½¿ç”¨ç‡
    "check_interval": 0.5,      // æ£€æŸ¥é—´éš”(ç§’)
    "throttle_threshold": 85.0  // é™æµé˜ˆå€¼
  }
}
```

## ğŸ“Š ç›‘æ§ä¿¡æ¯

### æ§åˆ¶å°è¾“å‡º
```
ğŸ›¡ï¸  CPUä¿æŠ¤å·²å¯åŠ¨ï¼Œæœ€å¤§ä½¿ç”¨ç‡é™åˆ¶ä¸º90%
âš ï¸  CPUä½¿ç”¨ç‡è¿‡é«˜ (92.3%)ï¼Œå¯åŠ¨é™æµä¿æŠ¤...
âœ… CPUä½¿ç”¨ç‡æ¢å¤æ­£å¸¸ (78.5%)ï¼Œè§£é™¤é™æµ
```

### æ—¥å¿—è®°å½•
- CPUä½¿ç”¨ç‡å†å²
- é™æµäº‹ä»¶è®°å½•
- æ€§èƒ½å½±å“åˆ†æ

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•CPUä¿æŠ¤åŠŸèƒ½
```bash
python3 test_cpu_throttle.py
```

### æ‰‹åŠ¨å‹åŠ›æµ‹è¯•
```bash
# åˆ›å»ºCPUå¯†é›†å‹ä»»åŠ¡
python3 -c "
import time
from concurrent.futures import ThreadPoolExecutor

def cpu_task():
    end = time.time() + 5
    while time.time() < end:
        sum(i*i for i in range(10000))

with ThreadPoolExecutor(max_workers=12) as executor:
    futures = [executor.submit(cpu_task) for _ in range(12)]
    for f in futures:
        f.result()
"
```

## ğŸ“ˆ æ€§èƒ½å½±å“

### æ­£å¸¸æƒ…å†µ
- CPUä¿æŠ¤å¼€é”€ï¼š< 1%
- å»¶è¿Ÿå¢åŠ ï¼šå‡ ä¹æ— æ„ŸçŸ¥
- å†…å­˜å ç”¨ï¼š< 10MB

### é«˜è´Ÿè½½æƒ…å†µ
- å¤„ç†é€Ÿåº¦ï¼šé™ä½10-20%ï¼ˆç¨³å®šä¼˜å…ˆï¼‰
- ç³»ç»Ÿç¨³å®šæ€§ï¼šæ˜¾è‘—æå‡ (é˜²æ­¢æ­»æœº)
- ç”¨æˆ·ä½“éªŒï¼šæµç•…å¯æ§

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: CPUä¿æŠ¤ä¸ç”Ÿæ•ˆ
**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æ˜¯å¦æ­£ç¡®å¯åŠ¨
python3 -c "from src.utils.cpu_throttle import is_cpu_throttling; print(f'é™æµçŠ¶æ€: {is_cpu_throttling()}')"

# é‡æ–°å¯åŠ¨ä¿æŠ¤
python3 -c "from src.utils.cpu_throttle import start_global_cpu_protection; start_global_cpu_protection()"
```

### é—®é¢˜2: å¤„ç†é€Ÿåº¦å¤ªæ…¢
**è§£å†³æ–¹æ¡ˆ**:
```bash
# è°ƒæ•´CPUé™åˆ¶é˜ˆå€¼
# ç¼–è¾‘ config/cpu_protection.json
# å°† max_cpu_percent ä» 90 è°ƒæ•´ä¸º 95
```

### é—®é¢˜3: ä»ç„¶å‡ºç°ç³»ç»Ÿå…³æœº
**è§£å†³æ–¹æ¡ˆ**:
```bash
# é™ä½CPUé™åˆ¶é˜ˆå€¼
# å°† max_cpu_percent è°ƒæ•´ä¸º 80-85
# å‡å°‘å¹¶è¡Œçº¿ç¨‹æ•°
# æ£€æŸ¥å…¶ä»–ç¨‹åºCPUå ç”¨
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å¯åŠ¨å‰æ£€æŸ¥
```bash
# æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
top -l 1 | grep "CPU usage"
# å…³é—­ä¸å¿…è¦çš„ç¨‹åº
```

### 2. åˆç†é…ç½®
- å¼€å‘ç¯å¢ƒï¼šCPUé™åˆ¶ 85%
- ç”Ÿäº§ç¯å¢ƒï¼šCPUé™åˆ¶ 80%
- æœåŠ¡å™¨ç¯å¢ƒï¼šCPUé™åˆ¶ 75%

### 3. ç›‘æ§å»ºè®®
- å®šæœŸæŸ¥çœ‹CPUä½¿ç”¨ç‡å†å²
- å…³æ³¨é™æµäº‹ä»¶é¢‘ç‡
- ä¼˜åŒ–é«˜CPUå ç”¨çš„æ“ä½œ

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.1.1 (2025-12-11)
- âœ… æ–°å¢CPUä½¿ç”¨ç‡ä¿æŠ¤æœºåˆ¶
- âœ… æ™ºèƒ½çº¿ç¨‹è°ƒåº¦
- âœ… ç´§æ€¥ä¿æŠ¤åŠŸèƒ½
- âœ… å®‰å…¨å¯åŠ¨è„šæœ¬
- âœ… é…ç½®æ–‡ä»¶æ”¯æŒ

### è®¡åˆ’åŠŸèƒ½
- [ ] GPUä½¿ç”¨ç‡ä¿æŠ¤
- [ ] å†…å­˜ä½¿ç”¨ç‡ä¿æŠ¤
- [ ] è‡ªé€‚åº”æ€§èƒ½è°ƒä¼˜
- [ ] å¯è§†åŒ–ç›‘æ§é¢æ¿

## ğŸ¤ åé¦ˆå»ºè®®

å¦‚æœé‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `app_logs/`
2. è¿è¡Œè¯Šæ–­è„šæœ¬ `python3 test_cpu_throttle.py`
3. æäº¤Issueå¹¶é™„ä¸Šç³»ç»Ÿä¿¡æ¯

---

**âš ï¸ é‡è¦æé†’**: CPUä¿æŠ¤åŠŸèƒ½ä¼šåœ¨é«˜è´Ÿè½½æ—¶é™ä½å¤„ç†é€Ÿåº¦ï¼Œè¿™æ˜¯ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§çš„å¿…è¦æªæ–½ã€‚å¦‚æœéœ€è¦æœ€å¤§æ€§èƒ½ï¼Œè¯·ç¡®ä¿ç³»ç»Ÿæ•£çƒ­è‰¯å¥½å¹¶å…³é—­å…¶ä»–ç¨‹åºã€‚
