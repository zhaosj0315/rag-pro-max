# RAG Pro Max v2.2.0 迁移指南

## 📋 版本升级说明

从 v2.1.0 升级到 v2.2.0，主要变化是**标签页功能迁移**，用户界面和使用方式有所调整。

## 🔄 主要变化

### 1. 配置功能位置变更

#### 升级前 (v2.1.0)
```
🏠 主页
├── 知识库管理
├── 文档上传
├── ⚙️ 基础配置 (在侧边栏)
│   ├── LLM对话模型
│   ├── Embedding向量模型
│   └── 🔧 高级功能
└── 对话功能
```

#### 升级后 (v2.2.0)
```
🏠 主页                    ⚙️ 配置
├── 知识库管理              ├── LLM对话模型
├── 文档上传               ├── Embedding向量模型
└── 对话功能               └── 🔧 高级功能
```

### 2. 标签页布局

新版本采用5个标签页布局：
- **🏠 主页**: RAG核心功能
- **⚙️ 配置**: 模型配置功能 ← **新增专门标签页**
- **📊 监控**: 性能监控功能
- **🔧 工具**: 系统工具功能
- **ℹ️ 帮助**: 使用指南功能

## 🚀 用户使用指南

### 首次使用流程

1. **启动应用**
   ```bash
   rag  # 使用别名启动
   ```

2. **配置模型** (⚙️ 配置标签页)
   - 点击 "⚙️ 配置" 标签页
   - 配置LLM模型 (默认: Ollama + qwen2.5:7b)
   - 配置Embedding模型 (默认: BAAI/bge-small-zh-v1.5)
   - 启用高级功能 (Re-ranking + BM25)

3. **创建知识库** (🏠 主页)
   - 返回 "🏠 主页" 标签页
   - 输入知识库名称
   - 上传文档文件
   - 点击 "🚀 开始处理"

4. **自动跳转**
   - 知识库构建完成后自动跳转
   - 可以立即开始对话

### 配置功能详解

#### LLM对话模型配置
```
🔘 Ollama (本地)          ← 默认选择
🔘 OpenAI-Compatible (云端)

Ollama URL: http://localhost:11434  ← 默认地址
✅ Ollama已连接                    ← 状态检测

模型选择: [gpt-oss:20b ▼]         ← 下拉选择
⭐ 默认                           ← 保存为默认
```

#### Embedding向量模型配置
```
💡 用于理解文档语义

供应商: [HuggingFace (本地/极速) ▼]  ← 默认选择
模型: [BAAI/bge-large-zh-v1.5 ▼]    ← 具体模型
✅ 模型已就绪                       ← 状态显示
⭐ 默认                            ← 保存为默认
```

#### 高级功能配置
```
🔧 高级功能

☑️ 启用智能重排序 (Re-ranking)     ← 提升准确率10-20%
   Re-ranking模型: [BAAI/bge-reranker-base ▼]

☑️ 启用关键词增强 (BM25)          ← 混合检索
```

## 🔧 技术变更

### 1. 组件Key更新
为避免冲突，配置标签页组件使用新的key前缀：
```python
# 主页组件
key="llm_provider_main"

# 配置页组件  
key="config_llm_provider_radio"
```

### 2. 功能调用分离
```python
# 主页 - 只保留RAG核心功能
with tab_main:
    # 知识库管理
    # 文档上传
    # 对话功能

# 配置页 - 专门的配置功能
with tab_config:
    config_values = render_basic_config(defaults)
    advanced_config = render_advanced_config()
```

### 3. 自动跳转逻辑
```python
# 知识库构建完成后
st.session_state.current_nav = f"📂 {final_kb_name}"
st.success(f"🎉 知识库 '{final_kb_name}' 构建完成！已自动切换到该知识库")
st.rerun()  # 刷新页面
```

## 📊 性能优化

### 1. 界面响应
- **配置默认展开**: 减少点击操作
- **辅助功能收起**: 界面更简洁
- **自动跳转**: 无需手动切换

### 2. 资源管理
- **功能分离**: 减少组件冲突
- **按需加载**: 只在配置页加载配置组件
- **内存优化**: 避免重复组件实例

## 🐛 问题排查

### 常见问题

1. **配置功能找不到**
   - 解决: 点击 "⚙️ 配置" 标签页
   - 所有配置功能已迁移到专门标签页

2. **组件冲突错误**
   - 解决: 已修复所有key冲突问题
   - 如遇到请重启应用

3. **知识库不自动跳转**
   - 解决: 已添加自动跳转功能
   - 构建完成后会自动切换

### 回退方案
如需回退到v2.1.0：
```bash
git checkout v2.1.0  # 如果使用git管理
# 或恢复备份文件
```

## 📝 开发者注意事项

### 1. 组件开发
- 新增配置组件需添加 `config_` 前缀
- 避免与主页组件key冲突

### 2. 功能扩展
- 配置相关功能添加到配置标签页
- RAG核心功能添加到主页标签页

### 3. 测试验证
- 测试所有标签页功能
- 验证组件无冲突
- 确认用户体验流畅

---

## 🎉 升级完成

v2.2.0 标签页迁移版本提供了更清晰的功能分离和更好的用户体验。

**主要收益:**
- ✅ 界面更清晰
- ✅ 功能更专业
- ✅ 操作更便捷
- ✅ 体验更流畅

*迁移指南更新时间: 2025-12-11 20:03*
