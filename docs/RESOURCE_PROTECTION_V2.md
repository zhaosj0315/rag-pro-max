# 资源保护系统 v2.0

## 1. 系统概述

资源保护系统旨在防止高负载任务（如 OCR、向量化）耗尽系统资源，导致应用卡死或系统崩溃。v2.0 版本引入了更智能的动态监控和自适应调度机制。

## 2. 核心机制

### 2.1 动态阈值监控
系统实时监控 CPU 和内存使用率，根据预设阈值采取行动：

- **CPU 阈值**: 75% (超过此值将暂停新任务或降低并发)
- **内存 阈值**: 85% (超过此值将触发垃圾回收或暂停任务)

### 2.2 任务调度策略
- **并发控制**: 动态调整并行任务数量 (max_workers)。
- **任务暂停**: 在资源紧张时自动暂停非关键任务。
- **自适应降级**: 如果连续触发高负载警告，自动降低处理速度。

### 2.3 紧急制动
提供手动和自动的紧急停止机制：
- **手动**: 界面上的 "停止" 按钮。
- **自动**: 如果 CPU 持续 100% 超过 30 秒，强制终止子进程。

## 3. 配置说明

在 `config/cpu_protection.json` 中可调整保护参数：

```json
{
  "cpu_threshold": 75,
  "memory_threshold": 85,
  "check_interval": 0.5,
  "continuous_high_load_limit": 10
}
```

## 4. 最佳实践

- **文档上传**: 建议分批上传大量文档，避免一次性冲击系统。
- **OCR 处理**: 启用 GPU 加速可显著降低 CPU 负载。
- **后台任务**: 避免在处理文档时运行其他大型应用。

## 5. 故障排查

如果发现处理速度过慢：
1. 检查 "系统监控" 面板，确认资源使用情况。
2. 查看日志中的 "ResourceGuard" 警告信息。
3. 尝试增加 `check_interval` 或提高阈值 (仅限高性能机器)。
