URL: https://help.aliyun.com/zh/waf/web-application-firewall-3-0/getting-started/get-started-with-waf-3
标题: 使用云产品接入为ECS配置WAF防御CC攻击-Web应用防火墙-阿里云
内容长度: 4055 字符
==================================================

重要
本文中含有需要您注意的重要提示信息，忽略该信息可能对您的业务造成影响，请务必仔细阅读。
CC
攻击（Challenge Collapsar
攻击）是
DDoS
攻击的一种，通过持续发送高并发请求，耗尽服务器的计算资源或数据库连接，导致业务响应延迟、页面加载缓慢，典型特征包括
QPS
飙升和带宽占用增加。为保护暴露在公网的云服务器
ECS
实例免受此类攻击，可为其开启
Web
应用防火墙（Web Application Firewall，简称
WAF）
防护，有效抵御
CC
攻击，保障业务稳定运行。
适用范围
ECS
实例已部署
Web
服务，通过公网
IP
对外提供服务。
ECS
实例位于以下地域：
西南
1（成都）、华北
2（北京）、华北
3（张家口）、华东
1（杭州）、华东
2（上海）、华南
1（深圳）、华北
1（青岛）、中国（香港）、马来西亚（吉隆坡）、印度尼西亚（雅加达）、新加坡
。若不满足以上要求，请使用
CNAME
接入
。
步骤一：开通按量付费
WAF
实例
访问
Web
应用防火墙
3.0（按量付费）购买页
。
选择
商品类型
为
Web
应用防火墙
3.0
，并选择
付费模式
为
按量付费
后，完成如下配置。
配置项
说明
地域
决定
WAF
防护节点的位置，若部署网站的
ECS
实例位于中国内地，请选择
中国内地
，其他情况下，请选择
非中国内地
。
WAF
版本
默认为
按量
3.0
，无需配置。
流量计费保护阈值
保持默认值即可，后续支持修改。
服务关联角色
为了提供流量访问控制、监控分析等服务，WAF
需要访问您的云服务资源，请点击
创建服务关联角色
，系统会自动创建角色
AliyunServiceRoleForWaf
，无需手动对此角色做任何修改。
单击
立即购买
并完成下单。
步骤二：接入
ECS
实例
登录
Web
应用防火墙
3.0
控制台
，在顶部菜单栏选择资源组和地域（
中国内地
、
非中国内地
），然后在左侧导航栏单击
接入管理
。选择
云产品接入
页签，在左侧云产品类型列表，选择
云服务器
ECS
。
在右侧列表，找到目标
ECS
实例，在
操作
列单击
立即接入
。如果找不到目标实例，请单击页面右上角
同步资产
，若仍无法找到，说明实例不满足
适用范围
。
在
选择需要添加的实例&端口
区域，单击
操作
列的
添加端口
。
在弹出的
添加端口
页面，根据网站的端口与协议类型进行配置。
标准 HTTP 网站
如果您的网站地址为
http://yourdomain.com
，请选择
协议类型
为
HTTP
，
端口
为
80
。
标准 HTTPS 网站
如果您的网站地址为
https://yourdomain.com
，请选择
协议类型
为
HTTPS
，
端口
为
443
。
非标准端口网站
如果访问网址中明确包含端口号（格式为
域名:端口号
），则需按实际端口填写。例如：
http://yourdomain.com:8080
，
协议类型
：
HTTP
，
端口
：
8080
。
https://yourdomain.com:8443
，
协议类型
：
HTTPS
，
端口
：
8443
。
HTTP
网站
在
端口
区域，填写网站使用的端口。
在
协议类型
区域，选择
HTTP
。
HTTPS
网站
在
端口
区域，填写网站使用的端口。
在
协议类型
区域，选择
HTTPS
。
保持
HTTP2
、
TLS
协议版本
、
加密套件
、
扩展证书
配置为默认设置。
在
默认证书
区域，选择证书上传方式：
手动上传
：适用于证书未上传至阿里云
数字证书管理服务（原 SSL 证书）
的场景。
选择已有证书
：从阿里云
数字证书管理服务（原 SSL 证书）
中选择已签发或已上传的证书。
手动上传
证书名称
：为证书设置一个唯一的名称，不能与已上传的证书名称重复。
证书文件
：请使用文本编辑器打开并粘贴
PEM、CER、CRT 格式
的证书文本内容。
格式示例：
-----BEGIN CERTIFICATE-----......-----END CERTIFICATE-----
格式转换：若证书是 PFX、P7B 等格式，请使用
证书工具
将其转换为 PEM 格式。
证书链：若包含中间证书，请按照 “服务器证书、中间证书” 的顺序拼接后粘贴。
私钥文件
：请使用文本编辑器打开并粘贴 PEM 格式的私钥文本内容。
格式示例：
-----BEGIN RSA PRIVATE KEY-----......-----END RSA PRIVATE KEY-----
选择已有证书
从证书下拉列表中选择要上传到
WAF
的证书。
说明
若
WAF
控制台提示“
证书链完整性校验失败，使用该证书可能会影响您的业务访问
”，表示证书链存在完整性问题。请检查证书内容的正确性与完整性后，在
数字证书管理服务
控制台重新上传。具体操作，请参见
上传、同步和共享
SSL
证书
。
保持其他配置为默认设置，单击
确定
。
（可选）查看防护对象
：此时
ECS
实例已完成接入，WAF
已自动创建一个名为
实例
id-端口-资产类型
的防护对象，并为该防护对象默认启用
Web
核心防护规则等模块的防护规则，可以在
防护配置
>
防护对象
页面查看。
验证基础防护效果
：在浏览器访问
ECS
实例上托管的网站，并在其
URL
后附加
Web
攻击测试代码（例如
http://yourdomain.com/alert(xss)
），若返回
WAF
的
405
拦截提示页面，表示攻击被拦截，WAF
防护成功。
步骤三：配置
CC
防护规则
在左侧导航栏，选择
防护配置
>
Web 核心防护
。
在页面下方
CC
防护
区域，单击
新建模板
。
在
新建模板 - CC
防护
面板，完成以下配置。
配置项
说明
模板名称
为该模板设置一个便于您识别的名称。
是否设置为默认模板
保持默认未开启状态。
规则动作
选择当请求命中该规则时，要执行的防护动作。可选项：
防护
：适用于日常防护场景，只拦截高度异常的请求，误拦截率较低。
防护-紧急
：适用于高频
CC
攻击导致业务异常的紧急恢复场景，可高效拦截
CC
攻击，但可能产生较多误拦截。当
防护
模式无法有效阻断攻击，且出现网站响应延迟、流量激增、CPU
或内存使用率异常等情况时，可启用此模式。
说明
防护-紧急模式适用于网页或
H5
页面，但不适用于
API
或
Native App
业务。
生效对象
在
待选择对象
区域勾选
ECS
实例对应的防护对象，单击
图标将其移至右侧
已选择
区域。
单击
确定
。
步骤四：查看攻击防护数据
配置完成后，可以前往左侧导航栏
总览
页面。查看
防护总览
、
攻击情况
Top10
等信息，进行业务安全分析。
您已完成本快速入门教程的全部步骤，请根据实际需求选择后续操作：
继续使用
WAF(推荐)
：前往
进阶优化
。
暂不使用
WAF
：前往
释放资源
以停止计费。
进阶优化：增强防护与成本控制
在本文提供的配置基础上，若希望继续使用
WAF，可按以下方式进一步调整配置，以适配具体业务特征，从而获取更强的安全防护能力与更低的成本。
多模块协同防护
：本文仅启用
CC
防护模块，可结合以下多个防护模块实现协同防御。
自定义规则
：基于灵活的匹配条件与规则动作，针对特定攻击特征实施精准防护。例如，通过配置频率控制规则实现访问限流。
白名单
：允许符合指定特征的请求通过，如可信
IP
地址。
IP
黑名单
：阻断已知恶意
IP
的访问。
区域封禁
：一键封禁来自特定地理区域的请求。例如，当业务仅面向中国境内用户，且检测到大量境外攻击时，可启用该功能。
进阶接入配置
：WAF
提供多种资源接入方式，可根据业务需求进行选择。
云产品接入
ECS
实例
：本文采用此接入方式，旨在快速接入云产品实例。如存在
TLS
版本、加密套件、多证书配置需求，请参见
增强安全防护等级（HTTPS）
；如存在
WAF
前七层代理设置（如
CDN）、流量标记等配置需求，请参见
获取真实客户端信息
。
CNAME
接入
：通过域名接入，适用场景更广、使用限制更少、支持功能更多。
成本优化建议
：
流量计费保护
：为防止大流量攻击导致 QPS
激增并产生高额费用，可设置流量计费保护阈值，以限定 WAF 可处理的峰值 QPS。
SeCU
资源包
：SeCU
资源包是按量付费版
WAF
的成本优化方案，在开通按量付费
WAF
实例后，可购买
SeCU
资源包抵扣按量付费
WAF
产生的总费用。
包年包月版
WAF
：当计划长期使用
WAF
时，建议购买包年包月版
WAF
以获得更优单价。
释放资源停止计费
完成快速入门教程后，若您不再需要在教程中开通的
WAF，可以参照以下步骤关闭
WAF
停止计费。
警告
计费提示
：按量付费版
WAF
除请求处理费用外，还收取功能费用（包括
WAF
实例本身的费用等）。开通
WAF
后，无论是否接入资源，均会产生费用。若不再需要使用
WAF，请及时关闭
WAF
实例。
CNAME
接入注意事项
：若仅通过本文所述云产品方式接入，可忽略本项。若已配置
CNAME
接入，请在关闭
WAF
实例前，确保相关网站域名的
DNS
解析已回切至源站。
前往左侧导航栏
总览
页面，在顶部菜单栏，选择
WAF
实例的资源组和地域（
中国内地
、
非中国内地
）。
若显示如下界面，请单击右上角
访问控制台
。若未显示如下界面，请跳过此步骤。
在页面右侧区域单击
关闭
WAF
，在页面弹出的提示框中勾选相关内容后单击
确定
。
上一篇：快速入门
下一篇：操作指南
该文章对您有帮助吗？
反馈