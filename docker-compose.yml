services:
  rag-pro-max:
    build: .
    container_name: rag-pro-max
    # 使用host网络模式，可以直接访问宿主机的localhost
    network_mode: host
    volumes:
      # 持久化数据
      - ./vector_db_storage:/app/vector_db_storage
      - ./chat_histories:/app/chat_histories
      - ./hf_cache:/app/hf_cache
      - ./app_logs:/app/app_logs
      # 配置文件
      - ./rag_config.json:/app/rag_config.json
      - ./app_config.json:/app/app_config.json
      - ./projects_config.json:/app/projects_config.json
    environment:
      - TOKENIZERS_PARALLELISM=false
      - HF_HUB_OFFLINE=1
      - TRANSFORMERS_OFFLINE=1
      # Ollama地址（host模式下可以用localhost）
      - OLLAMA_HOST=http://localhost:11434
    restart: unless-stopped
    # 资源限制
    deploy:
      resources:
        limits:
          cpus: '12'
          memory: 48G
        reservations:
          cpus: '4'
          memory: 16G
